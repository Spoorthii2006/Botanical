import java.sql.*;

public class DBConnection {
    public static Connection getConnection() throws Exception {
        Class.forName("com.mysql.cj.jdbc.Driver");
        return DriverManager.getConnection(
                "jdbc:mysql://localhost:3306/botanical_db",
                "root",
                "your_password"
        );
    }
}
import java.io.*;
import javax.servlet.*;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.*;
import java.sql.*;

@WebServlet("/register")
public class RegisterServlet extends HttpServlet {
    protected void doPost(HttpServletRequest req, HttpServletResponse resp)
            throws ServletException, IOException {

        String email = req.getParameter("email");
        String pass = req.getParameter("password");

        try {
            Connection con = DBConnection.getConnection();
            PreparedStatement pst = con.prepareStatement("INSERT INTO users (email, password) VALUES (?, ?)");
            pst.setString(1, email);
            pst.setString(2, pass);
            pst.executeUpdate();

            resp.sendRedirect("login.html");
        } catch (Exception e) { e.printStackTrace(); }
    }
}
@WebServlet("/login")
public class LoginServlet extends HttpServlet {
    protected void doPost(HttpServletRequest req, HttpServletResponse resp)
            throws IOException, ServletException {

        String email = req.getParameter("email");
        String password = req.getParameter("password");

        try {
            Connection con = DBConnection.getConnection();
            PreparedStatement pst = con.prepareStatement(
                    "SELECT * FROM users WHERE email=? AND password=?"
            );
            pst.setString(1, email);
            pst.setString(2, password);

            ResultSet rs = pst.executeQuery();

            if (rs.next()) {
                req.getSession().setAttribute("user", email);
                resp.sendRedirect("dashboard.html");
            } else {
                resp.sendRedirect("login.html?error=1");
            }
        } catch (Exception e) { e.printStackTrace(); }
    }
}
@WebServlet("/addPlant")
@MultipartConfig
public class AddPlantServlet extends HttpServlet {
    protected void doPost(HttpServletRequest req, HttpServletResponse resp)
            throws ServletException, IOException {

        String name = req.getParameter("name");
        String date = req.getParameter("date");
        String desc = req.getParameter("desc");

        Part imgPart = req.getPart("image");
        Part modelPart = req.getPart("model");

        String imgName = imgPart.getSubmittedFileName();
        String modelName = modelPart.getSubmittedFileName();

        String imgPath = "images/" + imgName;
        String modelPath = "models/" + modelName;

        imgPart.write("C:/tomcat/webapps/yourProject/images/" + imgName);
        modelPart.write("C:/tomcat/webapps/yourProject/models/" + modelName);

        try {
            Connection con = DBConnection.getConnection();
            PreparedStatement pst = con.prepareStatement(
                "INSERT INTO plants (name, plantation_date, description, image_path, model_path) VALUES (?, ?, ?, ?, ?)"
            );

            pst.setString(1, name);
            pst.setString(2, date);
            pst.setString(3, desc);
            pst.setString(4, imgPath);
            pst.setString(5, modelPath);

            pst.executeUpdate();
            resp.sendRedirect("dashboard.html");
        } catch (Exception e) { e.printStackTrace(); }
    }
}@WebServlet("/viewPlants")
public class ViewPlantsServlet extends HttpServlet {
    protected void doGet(HttpServletRequest req, HttpServletResponse resp)
            throws IOException {

        resp.setContentType("text/html");
        PrintWriter out = resp.getWriter();

        try {
            Connection con = DBConnection.getConnection();
            Statement st = con.createStatement();
            ResultSet rs = st.executeQuery("SELECT * FROM plants");

            out.println("<html><body><h2>Plant Collection</h2>");

            while (rs.next()) {
                out.println("<div>");
                out.println("<h3>" + rs.getString("name") + "</h3>");
                out.println("<img src='" + rs.getString("image_path") + "' width='200'><br>");
                out.println("<model-viewer src='" + rs.getString("model_path") + "' auto-rotate camera-controls></model-viewer><br>");
                out.println("<p>" + rs.getString("description") + "</p>");
                out.println("</div><hr>");
            }

            out.println("</body></html>");

        } catch (Exception e) { e.printStackTrace(); }
    }
}
@WebServlet("/bookTicket")
public class TicketBookingServlet extends HttpServlet {
    protected void doPost(HttpServletRequest req, HttpServletResponse resp)
            throws IOException {

        String date = req.getParameter("visitDate");
        int tickets = Integer.parseInt(req.getParameter("tickets"));
        String user = (String) req.getSession().getAttribute("user");

        try {
            Connection con = DBConnection.getConnection();
            PreparedStatement pst = con.prepareStatement(
                "INSERT INTO tickets (user_email, visit_date, num_tickets) VALUES (?, ?, ?)"
            );

            pst.setString(1, user);
            pst.setString(2, date);
            pst.setInt(3, tickets);

            pst.executeUpdate();
            resp.sendRedirect("dashboard.html");

        } catch (Exception e) { e.printStackTrace(); }
    }
}

